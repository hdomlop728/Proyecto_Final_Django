{% extends 'base.html' %}

{% block title %}Detalle de factura{% endblock %}

{% block content %}
<div class="container" style="padding-top:80px;">
    <h1>Factura {{ factura.numero_serie }}</h1>
    <p><strong>Presupuesto:</strong> {{ factura.presupuesto }}</p>
    <p><strong>Estado:</strong> {{ factura.get_estado_display }}</p>
    <p><strong>Emisión:</strong> {{ factura.fecha_emision }}</p>
    <p><strong>Vencimiento:</strong> {{ factura.fecha_vencimiento }}</p>
    <hr>
    <h5>Importes</h5>
    <p><strong>Base:</strong> {{ total_base }}</p>
    <p><strong>Impuestos:</strong> {{ impuestos_percent }}%</p>
    <p><strong>Total (con impuestos):</strong> {{ total_con_impuestos }}</p>
    <p><strong>Total pagado:</strong> {{ factura.total_pagado }}</p>
    <p><strong>Saldo pendiente:</strong> {{ saldo_pendiente }}</p>
    <hr>
    <h5>Pagos</h5>
    <ul>
        {% for pago in pagos_list %}
        <li>{{ pago.fecha }} &ndash; {{ pago.cantidad }} ({{ pago.metodo }}){% if pago.notas %} — {{ pago.notas }}{% endif %}</li>
        {% empty %}
        <li>Sin pagos registrados.</li>
        {% endfor %}
    </ul>
    <div class="d-flex gap-2 mb-3">
        {% if perms.facturas.change_factura %}
        <a href="{% url 'factura_edit' factura.pk %}" class="btn btn-secondary">Editar</a>
        {% endif %}
        {% if perms.facturas.delete_factura %}
        <form method="post" action="{% url 'factura_delete' factura.pk %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger" onclick="return confirm('¿Eliminar esta factura?');">
                Eliminar
            </button>
        </form>
        {% endif %}
    </div>
    <a href="{% url 'factura_register_payment' factura.pk %}" class="btn btn-primary">Registrar pago</a>
    <a href="{% url 'factura_list' %}" class="btn btn-link">Volver a la lista</a>
</div>
{% endblock %}