{% extends 'base.html' %}

{% block title %}Facturas{% endblock %}

{% block content %}
<div class="container" style="padding-top:80px;">
    <h1>Facturas</h1>
    {% if perms.facturas.add_factura %}
    <a class="btn btn-primary mb-2" href="{% url 'factura_create' %}">Nueva factura</a>
    {% endif %}
    <a href="{% url 'facturas_exportar_csv' %}{% if request.GET.estado %}?estado={{ request.GET.estado }}{% endif %}" class="btn btn-success mb-2">
        <i class="bi bi-download"></i> Exportar CSV
    </a>

    <form method="get" class="mb-3">
        <label>Estado:</label>
        <select name="estado" class="form-select" onchange="this.form.submit()">
            <option value="">(todos)</option>
            {% for code,label in factura.ESTADOS %}{% comment %} can't access ESTADOS here; maybe define manually {% endcomment %}{% endfor %}
            <option value="pendiente" {% if request.GET.estado == 'pendiente' or request.session.facturas_ultimo_filtro_estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
            <option value="parcial" {% if request.GET.estado == 'parcial' or request.session.facturas_ultimo_filtro_estado == 'parcial' %}selected{% endif %}>Parcial</option>
            <option value="pagada" {% if request.GET.estado == 'pagada' or request.session.facturas_ultimo_filtro_estado == 'pagada' %}selected{% endif %}>Pagada</option>
            <option value="vencida" {% if request.GET.estado == 'vencida' or request.session.facturas_ultimo_filtro_estado == 'vencida' %}selected{% endif %}>Vencida</option>
            <option value="anulada" {% if request.GET.estado == 'anulada' or request.session.facturas_ultimo_filtro_estado == 'anulada' %}selected{% endif %}>Anulada</option>
        </select>
    </form>

    <ul class="list-group">
        {% for factura in facturas %}
        <li class="list-group-item">
            <a href="{% url 'factura_detail' factura.pk %}">{{ factura.numero_serie }}</a>
            &ndash; {{ factura.estado }}
        </li>
        {% empty %}
        <li class="list-group-item">No hay facturas.</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}